# Dfns Smart Account

This smart contract is heavily inspired from the SafeLite example: https://github.com/5afe/safe-eip7702/blob/main/safe-eip7702-contracts/contracts/experimental/SafeLite.sol
It was stripped from all unecessary logic to only keep the batch functionality.
It uses no dependency and rely on some assembly code to save gas usage.

It is deployed on the following chains:

| Blockchain          | Contract Address                                                                                                                            |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| Ethereum Mainnet    | [0xbd77a32e628e69d8b168d3813f019e51d787b569](https://etherscan.io/address/0xbd77a32e628e69d8b168d3813f019e51d787b569#code)                  |
| Ethereum Sepolia    | [0xbd77a32e628e69d8b168d3813f019e51d787b569](https://sepolia.etherscan.io/address/0xbd77a32e628e69d8b168d3813f019e51d787b569#code)          |
| Ethereum Holesky    | [0xbd77a32e628e69d8b168d3813f019e51d787b569](https://holesky.etherscan.io/address/0xbd77a32e628e69d8b168d3813f019e51d787b569#code)          |
| Base                | [0xbd77a32e628e69d8b168d3813f019e51d787b569](https://basescan.org/address/0xbd77a32e628e69d8b168d3813f019e51d787b569#code)                  |
| Base Sepolia        | [0xbd77a32e628e69d8b168d3813f019e51d787b569](https://sepolia.basescan.org/address/0xbd77a32e628e69d8b168d3813f019e51d787b569#code)          |
| Binance Smart Chain | [0xbd77a32e628e69d8b168d3813f019e51d787b569](https://bscscan.com/address/0xbd77a32e628e69d8b168d3813f019e51d787b569#code)                   |
| Binance Testnet     | [0xbd77a32e628e69d8b168d3813f019e51d787b569](https://testnet.bscscan.com/address/0xbd77a32e628e69d8b168d3813f019e51d787b569#code)           |
| Optimism            | [0xbd77a32e628e69d8b168d3813f019e51d787b569](https://optimistic.etherscan.io/address/0xbd77a32e628e69d8b168d3813f019e51d787b569#code)       |
| Optimism Sepolia    | [0xbd77a32e628e69d8b168d3813f019e51d787b569](https://sepolia-optimism.etherscan.io/address/0xbd77a32e628e69d8b168d3813f019e51d787b569#code) |


## Foundry

**Foundry is a blazing fast, portable and modular toolkit for Ethereum application development written in Rust.**

Foundry consists of:

-   **Forge**: Ethereum testing framework (like Truffle, Hardhat and DappTools).
-   **Cast**: Swiss army knife for interacting with EVM smart contracts, sending transactions and getting chain data.
-   **Anvil**: Local Ethereum node, akin to Ganache, Hardhat Network.
-   **Chisel**: Fast, utilitarian, and verbose solidity REPL.

## Documentation

https://book.getfoundry.sh/

## Usage

### Build

```shell
$ forge build
```

### Test

```shell
$ forge test
```

### Format

```shell
$ forge fmt
```

### Gas Snapshots

```shell
$ forge snapshot
```

### Anvil

```shell
$ anvil
```

### Deploy

```shell
$ forge create script/DfnsSmartAccount.sol:DfnsSmartAccount --rpc-url <your_rpc_url> --private-key <your_private_key>
```

copy the input, and use the Dfns API to broadcast the transaction:

`https://{{customerApiDomain}}/wallets/:walletId/transactions`

```json
{
  "kind": "Json",
  "transaction": {
    "data": "0x60a0604052348015600e575f5ffd5b506080516107066100245f395f50506107065ff3fe608060405260043610610028575f3560e01c806374fa41211461002c578063d087d28814610048575b5f5ffd5b61004660048036038101906100419190610473565b610072565b005b348015610053575f5ffd5b5061005c610200565b60405161006991906104ee565b60405180910390f35b5f61007b610211565b90505f815f015490505f7f47e79534a245952e8b16893a336b85a3d9ea9fa8c573f3d803afb92a794692185f1b46306040516020016100bc9392919061055e565b6040516020818303038152906040528051906020012090505f7f4f8bb4631e6552ac29b9d6bacf60ff8b5481e2af7c2104fe0261045fa69881115f1b87805190602001208460405160200161011393929190610593565b6040516020818303038152906040528051906020012090505f828260405160200161013f92919061063c565b604051602081830303815290604052805190602001209050610162818888610238565b610198576040517f8baa579f00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60018401855f0181905550875160205b818110156101f457808a015160601c601482018b0151603483018c0151605484018d015f5f838386885af15f81036101e2573d5f5f3e3d5ffd5b826054018601955050505050506101a8565b50505050505050505050565b5f610209610211565b5f0154905090565b5f7f10ee8db8a0021e326896fcf9b44ce61becefe5f52e3dfd0bb294aee9b73bc000905090565b5f5f601b60ff84901c0190505f7f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8416905060018683875f1b845f1b6040515f8152602001604052604051610290949392919061068d565b6020604051602081039080840390855afa1580156102b0573d5f5f3e3d5ffd5b5050506020604051035173ffffffffffffffffffffffffffffffffffffffff163073ffffffffffffffffffffffffffffffffffffffff1614925050509392505050565b5f604051905090565b5f5ffd5b5f5ffd5b5f5ffd5b5f5ffd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b6103528261030c565b810181811067ffffffffffffffff821117156103715761037061031c565b5b80604052505050565b5f6103836102f3565b905061038f8282610349565b919050565b5f67ffffffffffffffff8211156103ae576103ad61031c565b5b6103b78261030c565b9050602081019050919050565b828183375f83830152505050565b5f6103e46103df84610394565b61037a565b905082815260208101848484011115610400576103ff610308565b5b61040b8482856103c4565b509392505050565b5f82601f83011261042757610426610304565b5b81356104378482602086016103d2565b91505092915050565b5f819050919050565b61045281610440565b811461045c575f5ffd5b50565b5f8135905061046d81610449565b92915050565b5f5f5f6060848603121561048a576104896102fc565b5b5f84013567ffffffffffffffff8111156104a7576104a6610300565b5b6104b386828701610413565b93505060206104c48682870161045f565b92505060406104d58682870161045f565b9150509250925092565b6104e881610440565b82525050565b5f6020820190506105015f8301846104df565b92915050565b5f819050919050565b61051981610507565b82525050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6105488261051f565b9050919050565b6105588161053e565b82525050565b5f6060820190506105715f830186610510565b61057e60208301856104df565b61058b604083018461054f565b949350505050565b5f6060820190506105a65f830186610510565b6105b36020830185610510565b6105c060408301846104df565b949350505050565b5f81905092915050565b7f19010000000000000000000000000000000000000000000000000000000000005f82015250565b5f6106066002836105c8565b9150610611826105d2565b600282019050919050565b5f819050919050565b61063661063182610507565b61061c565b82525050565b5f610646826105fa565b91506106528285610625565b6020820191506106628284610625565b6020820191508190509392505050565b5f60ff82169050919050565b61068781610672565b82525050565b5f6080820190506106a05f830187610510565b6106ad602083018661067e565b6106ba6040830185610510565b6106c76060830184610510565b9594505050505056fea2646970667358221220183bdad4d5eb41321768cef7a758bbf3df56dae565a5070e0f36300aa08f27c664736f6c634300081d0033"
  }
}
```

```shell
forge verify-contract 0xbd77a32e628e69d8b168d3813f019e51d787b569 ./src/DfnsSmartAccount.sol:DfnsSmartAccount --verifier-url https://api-holesky.etherscan.io/api --etherscan-api-key <etherscan-private-key> --watch
```

### Cast

```shell
$ cast <subcommand>
```

### Help

```shell
$ forge --help
$ anvil --help
$ cast --help
```
